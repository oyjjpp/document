# Mysql常见问题

## 索引

- [深入理解 Mysql 索引底层原理](https://zhuanlan.zhihu.com/p/73204847)
- [纸上得来终觉浅，绝知此事要躬行.](https://www.cnblogs.com/MrYuChen-Blog/p/15672292.html)

```mysql
索引是对数据库表中一列或多列的值进行排序的一种结构。MySQL索引的建立对于MySQL的高效运行是很重要的，索引可以大大提高MySQL的检索速度。索引只是提高效率的一个因素，如果你的MySQL有大数据量的表，就需要花时间研究建立最优秀的索引，或优化查询语句。

简单类比一下，数据库如同书籍，索引如同书籍目录，假如我们需要从书籍查找与 xx 相关的内容，我们可以直接从目录中查找，定位到 xx 内容所在页面，如果目录中没有 xx 相关字符或者没有设置目录（索引），那只能逐字逐页阅读文本查找，效率可想而知。
```

### 为什么使用索引

```mysql
快速查找匹配where子句中的行
如果可以在多个索引中选择，mysql通常会使用找到最少行的索引
如果表具有多列索引，则优化器可以使用索引的任何最左前缀来查找行
当有表连接的时候，从其他表检索行数据
查找特定索引列的min和max的值
如果排序或者分组时可用索引的最左前缀完成的，则对表进行排序和分组
在某些情况下，可以优化查询以检索数据值而无需查找数据行

总结： 使用最主要的原因是使用提高效率
```

### 索引的优缺点

优点：

- 索引大大减小了服务器需要扫描的数据量，从而大大加快数据的检索速度，这也是创建索引的最主要的原因。
- 索引可以帮助服务器避免排序和创建临时表【B+树已经排序过的】
- 索引可以将随机IO变成顺序IO，减少IO次数
- 索引对于InnoDB（对索引支持行级锁）非常重要，因为它可以让查询锁更少的元组，提高了表访问并发性
- 关于InnoDB、索引和锁：InnoDB在二级索引上使用共享锁（读锁），但访问主键索引需要排他锁（写锁）
- 通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。
- 可以加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义。
- 在使用分组和排序子句进行数据检索时，同样可以显著减少查询中分组和排序的时间。
- 通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。

缺点：

- 创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加
- 索引需要占物理空间，除了数据表占用数据空间之外，每一个索引还要占用一定的物理空间，如果需要- 建立聚簇索引，那么需要占用的空间会更大
- 对表中的数据进行增、删、改的时候，索引也要动态的维护，这就降低了整数的维护速度
- 如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。
- 对于非常小的表，大部分情况下简单的全表扫描更高效；

### 创建索引准则

应该创建索引的列：

```mysql
在经常需要搜索的列上，可以加快搜索的速度

在作为主键的列上，强制该列的唯一性和组织表中数据的排列结构

在经常用在连接（JOIN）的列上，这些列主要是一外键，可以加快连接的速度[少用]

在经常需要根据范围（<，<=，=，>，>=，BETWEEN，IN）进行搜索的列上创建索引，因为索引已经排序，其指定的范围是连续的

在经常需要排序（order by）的列上创建索引，因为索引已经排序，这样查询可以利用索引的排序，加快排序查询时间；

在经常使用在WHERE子句中的列上面创建索引，加快条件的判断速度。
```

不该创建索引的列：

```mysql
对于那些在查询中很少使用或者参考的列不应该创建索引。若列很少使用到，因此有索引或者无索引，并不能提高查询速度。相反，由于增加了索引，反而降低了系统的维护速度和增大了空间需求。

对于那些只有很少数据值或者重复值多的列也不应该增加索引。【数据去重后的数据比趋于1,则索引效果越好】
这些列的取值很少，例如人事表的性别列，在查询的结果中，结果集的数据行占了表中数据行的很大比例，即需要在表中搜索的数据行的比例很大。增加索引，并不能明显加快检索速度。

对于那些定义为text, image和bit数据类型的列不应该增加索引。这些列的数据量要么相当大，要么取值很少。

当该列修改性能要求远远高于检索性能时，不应该创建索引。（修改性能和检索性能是互相矛盾的）
```

### 索引的分类

```mysql
主键索引(唯一且非空)【数据库默认建立的索引是给唯一键建立的】
唯一索引(唯一可为空)
普通索引(普通字段的索引)
全文索引(一般是varchar,char,text类型建立的，但很少用)
组合索引(多个字的建立的索引)
```

### mysql索引结构？

```mysql
常见的MySQL主要有两种结构：Hash索引和B+ Tree索引，我们使用的是InnoDB引擎，默认的是B+树。

因为Hash索引底层是哈希表，哈希表是一种以key-value存储数据的结构，所以多个数据在存储关系上是完全没有任何顺序关系的，对于区间查询是无法直接通过索引查询的，就需要全表扫描；哈希索引只适用于等值查询的场景。
哈希索引没办法利用索引完成排序，不支持多列联合索引的最左匹配规则；如果有大量重复键值得情况下，哈希索引的效率会很低，因为存在哈希碰撞问题。

而B+ Tree是一种多路平衡查询树，所以他的节点是天然有序的（左子节点小于父节点、父节点小于右子节点），所以对于范围查询的时候不需要做全表扫描。
```

### innodb索引用的是啥，为什么不用b-、红黑树

### B+树、B树、哈希索引区别及优点，主要解决什么问题？

### 覆盖查询和回表查询

```mysql
指一个查询语句的执行只用从索引中就能够取得，不必从数据表中读取。也可以称之为实现了索引覆盖。 当一条查询语句符合覆盖索引条件时，MySQL只需要通过索引就可以返回查询所需要的数据，这样避免了查到索引后再返回表操作，减少I/O提高效率。
```

### 聚簇索引和非聚簇索引

```mysql
InnoDB 里，索引B+ Tree的叶子节点存储了整行数据的是主键索引，也被称之为聚簇索引。而索引B+ Tree的叶子节点存储了主键的值的是非主键索引，也被称之为非聚簇索引。
```

### 哪些键可以设置唯一索引

### 什么场景下联合索引会失效？

### 最左匹配原则？问为什么有这个东西？

### mysql索引用过哪些？

### mysql主键索引和非主键索引在搜索和检索过程中有什么区别吗？

### sql索引优化问题

### MySQL优化（索引、分表分库）

### 数据库如何建索引

### mysql索引，mongodb和mysql索引的区别，给了条sql语句问索引怎么构建

## 性能

### explain字段含义

### sql查询性能瓶颈处理方式

### 一条update语录执行流程

### 一条sql的查询过程

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1a573fad98d453ba60f9babdade0b8d~tplv-k3u1fbpfcp-watermark.image)

### 什么操作会影响联表查询效率

### 分析sql性能好坏如何分析？

### 一条sql语句比较慢用什么方式去优化？

### sql慢查询

### mysql索引慢分析：线上开启slowlog，提取慢查询，然后仔细分析explain中tye字段以及extra字段，发生的具体场景及mysql是怎么做的

## 事务

### 事物四个特性？四种隔离级别？分别解决了什么问题？

ACID(原子性、一致性、隔离性、持久性)

### innoDB支持事务，他为什么支持事务？MYSQL是如何保证的？

### MVCC原理

### 默认的事务隔离级别是什么？

### 这个隔离级别是如何实现的？

### mysql如何实现事务的？

### 如果实现分布式事务？

## 分库分表

### 分库分表查询方式，数据库分库分表，什么时候分库什么时候分表

### mysql分库分表平滑扩容方案

### 最终一致性

### mysql分布式id

### 分库之后唯一性如何保证

### 分库分表分区有哪些差别？

### 分表遇到联表查询怎么分页？

### 分库分表常用模式

### 一开始一个项目数据比较多，后来需要分库分表，有什么思路在不停服务的情况下做到平滑切换？

## 设计

### 设计用户详情的表，如何生成主键

### 对mysql的设计掌握如何？

### 数据库用过哪些？

## 存储引擎

### mysql默认的存储引擎

### mysql的存储引擎了解哪些？区别是啥？

```mysql
InnoDB、MyISAM、memory、archive
mysql存储引擎是可插拔的，核心基础代码是与存储引擎分离的

1、InnoDB  
优点  
a、灾难恢复性好  
b、支持全部4种级别的事务  
c、使用行级锁  
d、对于innodb引擎中的表，数据的物理组织形式是簇表（数据按主键来组织，主键索引和数据是在一起的） 
e、实现了缓存管理  

2、MyISAM  
特点  
a、可以配合锁，实现操作系统下的复制备份，迁移  
b、使用表级锁，并发性能差  
c、支持全文检索  
d、灾难恢复性不佳  
e、不支持事务  
f、仅缓存索引  

3、memory  
提供内存表，也不支持事务，外键；使用内存表可以显著提供访问数据的速度，可以应用于频繁访问的  

4、archive  
被设计用来存储企业中的大量流水数据的存储引擎，使用zlib无损数据压缩，适合做日志记录，用户行为分析


```

## Mysql相关锁

### 锁的类型用过哪些

### 什么叫悲观锁？什么叫乐观锁？

### 乐观锁如何保证最终一致性？

### 脏读幻读说一下？

## 主从

### mysql主从同步过程了解吗？

### 复制原理及流程

## 缓存

### 缓存和数据库一致性的问题

[如何保持mysql和redis中数据的一致性？](https://www.zhihu.com/question/319817091/answer/2176813916)

## 知道mysqlinnodb是什么数据结构吗？

## 数据库加密算法是怎么设计的？设计这种东西通用规范是怎么设计的？
